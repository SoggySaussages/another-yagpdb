Parts of this section use paggy code, see license in this directory